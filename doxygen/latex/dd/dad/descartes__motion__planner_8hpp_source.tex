\hypertarget{descartes__motion__planner_8hpp_source}{}\doxysection{descartes\+\_\+motion\+\_\+planner.\+hpp}
\label{descartes__motion__planner_8hpp_source}\index{tesseract\_motion\_planners/descartes/include/tesseract\_motion\_planners/descartes/impl/descartes\_motion\_planner.hpp@{tesseract\_motion\_planners/descartes/include/tesseract\_motion\_planners/descartes/impl/descartes\_motion\_planner.hpp}}
\mbox{\hyperlink{descartes__motion__planner_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 }
\DoxyCodeLine{26 \textcolor{preprocessor}{\#ifndef TESSERACT\_MOTION\_PLANNERS\_IMPL\_DESCARTES\_DECARTES\_MOTION\_PLANNER\_HPP}}
\DoxyCodeLine{27 \textcolor{preprocessor}{\#define TESSERACT\_MOTION\_PLANNERS\_IMPL\_DESCARTES\_DECARTES\_MOTION\_PLANNER\_HPP}}
\DoxyCodeLine{28 }
\DoxyCodeLine{29 \textcolor{preprocessor}{\#include <tesseract\_common/macros.h>}}
\DoxyCodeLine{30 TESSERACT\_COMMON\_IGNORE\_WARNINGS\_PUSH}
\DoxyCodeLine{31 \textcolor{preprocessor}{\#include <descartes\_light/solvers/ladder\_graph/ladder\_graph\_solver.h>}}
\DoxyCodeLine{32 \textcolor{preprocessor}{\#include <descartes\_light/samplers/fixed\_joint\_waypoint\_sampler.h>}}
\DoxyCodeLine{33 \textcolor{preprocessor}{\#include <vector>}}
\DoxyCodeLine{34 TESSERACT\_COMMON\_IGNORE\_WARNINGS\_POP}
\DoxyCodeLine{35 }
\DoxyCodeLine{36 \textcolor{preprocessor}{\#include <tesseract\_collision/core/discrete\_contact\_manager.h>}}
\DoxyCodeLine{37 \textcolor{preprocessor}{\#include <tesseract\_collision/core/continuous\_contact\_manager.h>}}
\DoxyCodeLine{38 }
\DoxyCodeLine{39 \textcolor{preprocessor}{\#include <tesseract\_environment/environment.h>}}
\DoxyCodeLine{40 \textcolor{preprocessor}{\#include <tesseract\_environment/utils.h>}}
\DoxyCodeLine{41 }
\DoxyCodeLine{42 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{descartes__motion__planner_8h}{tesseract\_motion\_planners/descartes/descartes\_motion\_planner.h}}>}}
\DoxyCodeLine{43 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{descartes__default__plan__profile_8h}{tesseract\_motion\_planners/descartes/profile/descartes\_default\_plan\_profile.h}}>}}
\DoxyCodeLine{44 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{tesseract__motion__planners_2core_2include_2tesseract__motion__planners_2core_2utils_8h}{tesseract\_motion\_planners/core/utils.h}}>}}
\DoxyCodeLine{45 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{planner__utils_8h}{tesseract\_motion\_planners/planner\_utils.h}}>}}
\DoxyCodeLine{46 }
\DoxyCodeLine{47 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{command__language_8h}{tesseract\_command\_language/command\_language.h}}>}}
\DoxyCodeLine{48 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{tesseract__command__language_2include_2tesseract__command__language_2utils_2utils_8h}{tesseract\_command\_language/utils/utils.h}}>}}
\DoxyCodeLine{49 }
\DoxyCodeLine{50 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacetesseract__planning}{tesseract\_planning}}}
\DoxyCodeLine{51 \{}
\DoxyCodeLine{52 \textcolor{keyword}{template} <\textcolor{keyword}{typename} FloatType>}
\DoxyCodeLine{53 \mbox{\hyperlink{classtesseract__planning_1_1DescartesMotionPlanner_a0189e26eea69ff9160f717fab2414e22}{DescartesMotionPlanner<FloatType>::DescartesMotionPlanner}}(std::string name)}
\DoxyCodeLine{54   : name\_(std::move(name)), status\_category\_(std::make\_shared<const \mbox{\hyperlink{classtesseract__planning_1_1DescartesMotionPlannerStatusCategory}{DescartesMotionPlannerStatusCategory}}>(name\_))}
\DoxyCodeLine{55 \{}
\DoxyCodeLine{56   \textcolor{keywordflow}{if} (\mbox{\hyperlink{classtesseract__planning_1_1DescartesMotionPlanner_ab0a92589aafb9c14410140c098c24e98}{name\_}}.empty())}
\DoxyCodeLine{57     \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"{}DescartesMotionPlanner name is empty!"{}});}
\DoxyCodeLine{58 \}}
\DoxyCodeLine{59 }
\DoxyCodeLine{60 \textcolor{keyword}{template} <\textcolor{keyword}{typename} FloatType>}
\DoxyCodeLine{61 \textcolor{keyword}{const} std::string\& \mbox{\hyperlink{classtesseract__planning_1_1DescartesMotionPlanner_ad424282e611add853a8fc23b9c98422a}{DescartesMotionPlanner<FloatType>::getName}}()\textcolor{keyword}{ const}}
\DoxyCodeLine{62 \textcolor{keyword}{}\{}
\DoxyCodeLine{63   \textcolor{keywordflow}{return} name\_;}
\DoxyCodeLine{64 \}}
\DoxyCodeLine{65 }
\DoxyCodeLine{66 \textcolor{keyword}{template} <\textcolor{keyword}{typename} FloatType>}
\DoxyCodeLine{67 tesseract\_common::StatusCode \mbox{\hyperlink{classtesseract__planning_1_1DescartesMotionPlanner_aa608f79fb4516b7ae901c78d4f77adcb}{DescartesMotionPlanner<FloatType>::solve}}(\textcolor{keyword}{const} \mbox{\hyperlink{structtesseract__planning_1_1PlannerRequest}{PlannerRequest}}\& request,}
\DoxyCodeLine{68                                                                       \mbox{\hyperlink{structtesseract__planning_1_1PlannerResponse}{PlannerResponse}}\& response,}
\DoxyCodeLine{69                                                                       \textcolor{keyword}{const} \textcolor{keywordtype}{bool} \textcolor{comment}{/*verbose*/})\textcolor{keyword}{ const}}
\DoxyCodeLine{70 \textcolor{keyword}{}\{}
\DoxyCodeLine{71   std::shared\_ptr<DescartesProblem<FloatType>> problem;}
\DoxyCodeLine{72   \textcolor{keywordflow}{if} (request.\mbox{\hyperlink{structtesseract__planning_1_1PlannerRequest_a74225e42fe18279b21af4a922fa80995}{data}})}
\DoxyCodeLine{73   \{}
\DoxyCodeLine{74     problem = std::static\_pointer\_cast<DescartesProblem<FloatType>>(request.\mbox{\hyperlink{structtesseract__planning_1_1PlannerRequest_a74225e42fe18279b21af4a922fa80995}{data}});}
\DoxyCodeLine{75   \}}
\DoxyCodeLine{76   \textcolor{keywordflow}{else}}
\DoxyCodeLine{77   \{}
\DoxyCodeLine{78     \textcolor{keywordflow}{try}}
\DoxyCodeLine{79     \{}
\DoxyCodeLine{80       problem = createProblem(request);}
\DoxyCodeLine{81     \}}
\DoxyCodeLine{82     \textcolor{keywordflow}{catch} (std::exception\& e)}
\DoxyCodeLine{83     \{}
\DoxyCodeLine{84       CONSOLE\_BRIDGE\_logError(\textcolor{stringliteral}{"{}DescartesMotionPlanner failed to generate problem: \%s."{}}, e.what());}
\DoxyCodeLine{85       response.\mbox{\hyperlink{structtesseract__planning_1_1PlannerResponse_a768f7be97302935b5223b00c37611efe}{status}} =}
\DoxyCodeLine{86           tesseract\_common::StatusCode(\mbox{\hyperlink{classtesseract__planning_1_1DescartesMotionPlannerStatusCategory_ab8899673e2e90cd1822f58276522bbb9a84ec64cf46681e21bcc3102f43dfbc07}{DescartesMotionPlannerStatusCategory::ErrorInvalidInput}}, status\_category\_);}
\DoxyCodeLine{87       \textcolor{keywordflow}{return} response.\mbox{\hyperlink{structtesseract__planning_1_1PlannerResponse_a768f7be97302935b5223b00c37611efe}{status}};}
\DoxyCodeLine{88     \}}
\DoxyCodeLine{89 }
\DoxyCodeLine{90     response.\mbox{\hyperlink{structtesseract__planning_1_1PlannerResponse_ab010e84ee5bd79ee47b0e45efb6419f6}{data}} = problem;}
\DoxyCodeLine{91   \}}
\DoxyCodeLine{92 }
\DoxyCodeLine{93   descartes\_light::SearchResult<FloatType> descartes\_result;}
\DoxyCodeLine{94   \textcolor{keywordflow}{try}}
\DoxyCodeLine{95   \{}
\DoxyCodeLine{96     descartes\_light::LadderGraphSolver<FloatType> solver(problem-\/>num\_threads);}
\DoxyCodeLine{97     solver.build(problem-\/>samplers, problem-\/>edge\_evaluators, problem-\/>state\_evaluators);}
\DoxyCodeLine{98     descartes\_result = solver.search();}
\DoxyCodeLine{99     \textcolor{keywordflow}{if} (descartes\_result.trajectory.empty())}
\DoxyCodeLine{100     \{}
\DoxyCodeLine{101       CONSOLE\_BRIDGE\_logError(\textcolor{stringliteral}{"{}Search for graph completion failed"{}});}
\DoxyCodeLine{102       response.\mbox{\hyperlink{structtesseract__planning_1_1PlannerResponse_a768f7be97302935b5223b00c37611efe}{status}} = tesseract\_common::StatusCode(}
\DoxyCodeLine{103           \mbox{\hyperlink{classtesseract__planning_1_1DescartesMotionPlannerStatusCategory_ab8899673e2e90cd1822f58276522bbb9a48a5f40bd6d19e7ec907e1f00752a4d9}{DescartesMotionPlannerStatusCategory::ErrorFailedToFindValidSolution}}, status\_category\_);}
\DoxyCodeLine{104       \textcolor{keywordflow}{return} response.\mbox{\hyperlink{structtesseract__planning_1_1PlannerResponse_a768f7be97302935b5223b00c37611efe}{status}};}
\DoxyCodeLine{105     \}}
\DoxyCodeLine{106   \}}
\DoxyCodeLine{107   \textcolor{keywordflow}{catch} (...)}
\DoxyCodeLine{108   \{}
\DoxyCodeLine{109     \textcolor{comment}{//    CONSOLE\_BRIDGE\_logError("{}Failed to build vertices"{});}}
\DoxyCodeLine{110     \textcolor{comment}{//    for (const auto\& i : graph\_builder.getFailedVertices())}}
\DoxyCodeLine{111     \textcolor{comment}{//      response.failed\_waypoints.push\_back(config\_-\/>waypoints[i]);}}
\DoxyCodeLine{112 }
\DoxyCodeLine{113     \textcolor{comment}{//    // Copy the waypoint if it is not already in the failed waypoints list}}
\DoxyCodeLine{114     \textcolor{comment}{//    std::copy\_if(config\_-\/>waypoints.begin(),}}
\DoxyCodeLine{115     \textcolor{comment}{//                 config\_-\/>waypoints.end(),}}
\DoxyCodeLine{116     \textcolor{comment}{//                 std::back\_inserter(response.succeeded\_waypoints),}}
\DoxyCodeLine{117     \textcolor{comment}{//                 [\&response](const Waypoint::ConstPtr wp) \{}}
\DoxyCodeLine{118     \textcolor{comment}{//                   return std::find(response.failed\_waypoints.begin(), response.failed\_waypoints.end(), wp) ==}}
\DoxyCodeLine{119     \textcolor{comment}{//                          response.failed\_waypoints.end();}}
\DoxyCodeLine{120     \textcolor{comment}{//                 \});}}
\DoxyCodeLine{121 }
\DoxyCodeLine{122     response.\mbox{\hyperlink{structtesseract__planning_1_1PlannerResponse_a768f7be97302935b5223b00c37611efe}{status}} =}
\DoxyCodeLine{123         tesseract\_common::StatusCode(\mbox{\hyperlink{classtesseract__planning_1_1DescartesMotionPlannerStatusCategory_ab8899673e2e90cd1822f58276522bbb9a8e7464917a6f10d6f455f64c28fef810}{DescartesMotionPlannerStatusCategory::ErrorFailedToBuildGraph}}, status\_category\_);}
\DoxyCodeLine{124     \textcolor{keywordflow}{return} response.\mbox{\hyperlink{structtesseract__planning_1_1PlannerResponse_a768f7be97302935b5223b00c37611efe}{status}};}
\DoxyCodeLine{125   \}}
\DoxyCodeLine{126 }
\DoxyCodeLine{127   \textcolor{comment}{// Enforce limits}}
\DoxyCodeLine{128   std::vector<Eigen::VectorXd> solution\{\};}
\DoxyCodeLine{129   solution.reserve(descartes\_result.trajectory.size());}
\DoxyCodeLine{130   \textcolor{keywordflow}{for} (\textcolor{keyword}{const} \textcolor{keyword}{auto}\& js : descartes\_result.trajectory)}
\DoxyCodeLine{131   \{}
\DoxyCodeLine{132     solution.push\_back(js-\/>values.template cast<double>());}
\DoxyCodeLine{133     \textcolor{comment}{// Using 1e-\/6 because when using floats with descartes epsilon does not seem to be enough}}
\DoxyCodeLine{134     assert(}
\DoxyCodeLine{135         tesseract\_common::satisfiesPositionLimits<double>(solution.back(), problem-\/>manip-\/>getLimits().joint\_limits));}
\DoxyCodeLine{136     tesseract\_common::enforcePositionLimits<double>(solution.back(), problem-\/>manip-\/>getLimits().joint\_limits);}
\DoxyCodeLine{137   \}}
\DoxyCodeLine{138 }
\DoxyCodeLine{139   \textcolor{comment}{// Flatten the results to make them easier to process}}
\DoxyCodeLine{140   response.\mbox{\hyperlink{structtesseract__planning_1_1PlannerResponse_a45bcd81063b3001e3ca99cd6c03b3720}{results}} = request.\mbox{\hyperlink{structtesseract__planning_1_1PlannerRequest_a610e5a50fcb3b62f94b085072170669f}{seed}};}
\DoxyCodeLine{141   \textcolor{keyword}{auto} results\_flattened = \mbox{\hyperlink{namespacetesseract__planning_a376b0dd548ca385a3128afc20bdc1dca}{flattenProgramToPattern}}(response.\mbox{\hyperlink{structtesseract__planning_1_1PlannerResponse_a45bcd81063b3001e3ca99cd6c03b3720}{results}}, request.\mbox{\hyperlink{structtesseract__planning_1_1PlannerRequest_a8c6a68b833fbe425b10ff295be07cff7}{instructions}});}
\DoxyCodeLine{142   \textcolor{keyword}{auto} instructions\_flattened = \mbox{\hyperlink{namespacetesseract__planning_a1172c93ff97196d2037dc67a853c0625}{flattenProgram}}(request.\mbox{\hyperlink{structtesseract__planning_1_1PlannerRequest_a8c6a68b833fbe425b10ff295be07cff7}{instructions}});}
\DoxyCodeLine{143 }
\DoxyCodeLine{144   \textcolor{comment}{// Loop over the flattened results and add them to response if the input was a plan instruction}}
\DoxyCodeLine{145   std::size\_t result\_index = 0;}
\DoxyCodeLine{146   \textcolor{keywordflow}{for} (std::size\_t idx = 0; idx < instructions\_flattened.size(); idx++)}
\DoxyCodeLine{147   \{}
\DoxyCodeLine{148     \textcolor{comment}{// If idx is zero then this should be the start instruction}}
\DoxyCodeLine{149     assert((idx == 0) ? \mbox{\hyperlink{namespacetesseract__planning_a7c15fced3d0a2819bef3c874d85b1f8f}{isPlanInstruction}}(instructions\_flattened.at(idx).get()) : \textcolor{keyword}{true});}
\DoxyCodeLine{150     assert((idx == 0) ? \mbox{\hyperlink{namespacetesseract__planning_a2a1d26a1924d6b53c23630143a579436}{isMoveInstruction}}(results\_flattened[idx].get()) : \textcolor{keyword}{true});}
\DoxyCodeLine{151     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacetesseract__planning_a7c15fced3d0a2819bef3c874d85b1f8f}{isPlanInstruction}}(instructions\_flattened.at(idx).get()))}
\DoxyCodeLine{152     \{}
\DoxyCodeLine{153       \textcolor{keyword}{const} \textcolor{keyword}{auto}\& plan\_instruction = instructions\_flattened.at(idx).get().as<\mbox{\hyperlink{classtesseract__planning_1_1PlanInstruction}{PlanInstruction}}>();}
\DoxyCodeLine{154       \textcolor{keywordflow}{if} (plan\_instruction.isStart())}
\DoxyCodeLine{155       \{}
\DoxyCodeLine{156         assert(idx == 0);}
\DoxyCodeLine{157         assert(\mbox{\hyperlink{namespacetesseract__planning_a2a1d26a1924d6b53c23630143a579436}{isMoveInstruction}}(results\_flattened[idx].get()));}
\DoxyCodeLine{158         \textcolor{keyword}{auto}\& move\_instruction = results\_flattened[idx].get().as<\mbox{\hyperlink{classtesseract__planning_1_1MoveInstruction}{MoveInstruction}}>();}
\DoxyCodeLine{159 }
\DoxyCodeLine{160         \textcolor{keyword}{auto}\& swp = move\_instruction.\mbox{\hyperlink{classtesseract__planning_1_1MoveInstruction_af9dd6ba043a2ae38129847a98d90a540}{getWaypoint}}().as<\mbox{\hyperlink{classtesseract__planning_1_1StateWaypoint}{StateWaypoint}}>();}
\DoxyCodeLine{161         swp.position = solution[result\_index++];}
\DoxyCodeLine{162         assert(swp.joint\_names == problem-\/>manip-\/>getJointNames());}
\DoxyCodeLine{163       \}}
\DoxyCodeLine{164       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (plan\_instruction.isLinear())}
\DoxyCodeLine{165       \{}
\DoxyCodeLine{166         \textcolor{comment}{// This instruction corresponds to a composite. Set all results in that composite to the results}}
\DoxyCodeLine{167         assert(\mbox{\hyperlink{namespacetesseract__planning_af48bb1d750c019e34337ed0a0f88ef76}{isCompositeInstruction}}(results\_flattened[idx].get()));}
\DoxyCodeLine{168         \textcolor{keyword}{auto}\& move\_instructions = results\_flattened[idx].get().as<\mbox{\hyperlink{classtesseract__planning_1_1CompositeInstruction}{CompositeInstruction}}>();}
\DoxyCodeLine{169         \textcolor{keywordflow}{for} (\textcolor{keyword}{auto}\& instruction : move\_instructions)}
\DoxyCodeLine{170         \{}
\DoxyCodeLine{171           \textcolor{keyword}{auto}\& swp = instruction.as<\mbox{\hyperlink{classtesseract__planning_1_1MoveInstruction}{MoveInstruction}}>().getWaypoint().as<\mbox{\hyperlink{classtesseract__planning_1_1StateWaypoint}{StateWaypoint}}>();}
\DoxyCodeLine{172           swp.position = solution[result\_index++];}
\DoxyCodeLine{173           assert(swp.joint\_names == problem-\/>manip-\/>getJointNames());}
\DoxyCodeLine{174         \}}
\DoxyCodeLine{175       \}}
\DoxyCodeLine{176       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (plan\_instruction.isFreespace())}
\DoxyCodeLine{177       \{}
\DoxyCodeLine{178         assert(result\_index > 0);}
\DoxyCodeLine{179         \textcolor{comment}{// Because descartes does not support freespace it just includes the plan instruction waypoint so we will}}
\DoxyCodeLine{180         \textcolor{comment}{// fill out the results with a joint interpolated trajectory.}}
\DoxyCodeLine{181         Eigen::VectorXd\& start = solution[result\_index -\/ 1];}
\DoxyCodeLine{182         Eigen::VectorXd\& stop = solution[result\_index++];}
\DoxyCodeLine{183 }
\DoxyCodeLine{184         \textcolor{comment}{// This instruction corresponds to a composite. Set all results in that composite to the results}}
\DoxyCodeLine{185         assert(\mbox{\hyperlink{namespacetesseract__planning_af48bb1d750c019e34337ed0a0f88ef76}{isCompositeInstruction}}(results\_flattened[idx].get()));}
\DoxyCodeLine{186         \textcolor{keyword}{auto}\& move\_instructions = results\_flattened[idx].get().as<\mbox{\hyperlink{classtesseract__planning_1_1CompositeInstruction}{CompositeInstruction}}>();}
\DoxyCodeLine{187 }
\DoxyCodeLine{188         Eigen::MatrixXd temp = \mbox{\hyperlink{namespacetesseract__planning_a71ea10c42f51ae6e4d014ad054c900f6}{interpolate}}(start, stop, \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(move\_instructions.size()));}
\DoxyCodeLine{189 }
\DoxyCodeLine{190         assert(temp.cols() == \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{long}\textcolor{keyword}{>}(move\_instructions.size()) + 1);}
\DoxyCodeLine{191         \textcolor{keywordflow}{for} (std::size\_t i = 0; i < move\_instructions.size(); ++i)}
\DoxyCodeLine{192         \{}
\DoxyCodeLine{193           \textcolor{keyword}{auto}\& swp = move\_instructions[i].as<\mbox{\hyperlink{classtesseract__planning_1_1MoveInstruction}{MoveInstruction}}>().getWaypoint().as<\mbox{\hyperlink{classtesseract__planning_1_1StateWaypoint}{StateWaypoint}}>();}
\DoxyCodeLine{194           swp.position = temp.col(\textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{long}\textcolor{keyword}{>}(i) + 1);}
\DoxyCodeLine{195           assert(swp.joint\_names == problem-\/>manip-\/>getJointNames());}
\DoxyCodeLine{196         \}}
\DoxyCodeLine{197       \}}
\DoxyCodeLine{198       \textcolor{keywordflow}{else}}
\DoxyCodeLine{199       \{}
\DoxyCodeLine{200         \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"{}Unsupported Plan Instruction Type!"{}});}
\DoxyCodeLine{201       \}}
\DoxyCodeLine{202     \}}
\DoxyCodeLine{203   \}}
\DoxyCodeLine{204 }
\DoxyCodeLine{205   response.\mbox{\hyperlink{structtesseract__planning_1_1PlannerResponse_a768f7be97302935b5223b00c37611efe}{status}} = tesseract\_common::StatusCode(\mbox{\hyperlink{classtesseract__planning_1_1DescartesMotionPlannerStatusCategory_ab8899673e2e90cd1822f58276522bbb9ab162847308b3e8a171161cf6b9aeb95c}{DescartesMotionPlannerStatusCategory::SolutionFound}}, status\_category\_);}
\DoxyCodeLine{206   \textcolor{keywordflow}{return} response.\mbox{\hyperlink{structtesseract__planning_1_1PlannerResponse_a768f7be97302935b5223b00c37611efe}{status}};}
\DoxyCodeLine{207 \}}
\DoxyCodeLine{208 }
\DoxyCodeLine{209 \textcolor{keyword}{template} <\textcolor{keyword}{typename} FloatType>}
\DoxyCodeLine{210 \textcolor{keywordtype}{bool} \mbox{\hyperlink{classtesseract__planning_1_1DescartesMotionPlanner_a2efeee49747eca2399ff5103e29924eb}{DescartesMotionPlanner<FloatType>::checkUserInput}}(\textcolor{keyword}{const} \mbox{\hyperlink{structtesseract__planning_1_1PlannerRequest}{PlannerRequest}}\& request)}
\DoxyCodeLine{211 \{}
\DoxyCodeLine{212   \textcolor{comment}{// Check that parameters are valid}}
\DoxyCodeLine{213   \textcolor{keywordflow}{if} (request.\mbox{\hyperlink{structtesseract__planning_1_1PlannerRequest_a2808ed97d04b1681ec4b5b7c5b3155f0}{env}} == \textcolor{keyword}{nullptr})}
\DoxyCodeLine{214   \{}
\DoxyCodeLine{215     CONSOLE\_BRIDGE\_logError(\textcolor{stringliteral}{"{}In TrajOptPlannerUniversalConfig: env is a required parameter and has not been set"{}});}
\DoxyCodeLine{216     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{217   \}}
\DoxyCodeLine{218 }
\DoxyCodeLine{219   \textcolor{keywordflow}{if} (request.\mbox{\hyperlink{structtesseract__planning_1_1PlannerRequest_a8c6a68b833fbe425b10ff295be07cff7}{instructions}}.\mbox{\hyperlink{classtesseract__planning_1_1CompositeInstruction_a4012a6e33463e22d7c1b6c838a07de08}{empty}}())}
\DoxyCodeLine{220   \{}
\DoxyCodeLine{221     CONSOLE\_BRIDGE\_logError(\textcolor{stringliteral}{"{}TrajOptPlannerUniversalConfig requires at least one instruction"{}});}
\DoxyCodeLine{222     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{223   \}}
\DoxyCodeLine{224 }
\DoxyCodeLine{225   \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{226 \}}
\DoxyCodeLine{227 }
\DoxyCodeLine{228 \textcolor{keyword}{template} <\textcolor{keyword}{typename} FloatType>}
\DoxyCodeLine{229 \textcolor{keywordtype}{bool} \mbox{\hyperlink{classtesseract__planning_1_1DescartesMotionPlanner_a0bb1f4ff5c88060f87c72dcdda8417c3}{DescartesMotionPlanner<FloatType>::terminate}}()}
\DoxyCodeLine{230 \{}
\DoxyCodeLine{231   CONSOLE\_BRIDGE\_logWarn(\textcolor{stringliteral}{"{}Termination of ongoing optimization is not implemented yet"{}});}
\DoxyCodeLine{232   \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{233 \}}
\DoxyCodeLine{234 }
\DoxyCodeLine{235 \textcolor{keyword}{template} <\textcolor{keyword}{typename} FloatType>}
\DoxyCodeLine{236 \textcolor{keywordtype}{void} \mbox{\hyperlink{classtesseract__planning_1_1DescartesMotionPlanner_afec3c9ed00949cb779dfa7ad78cd8bee}{DescartesMotionPlanner<FloatType>::clear}}()}
\DoxyCodeLine{237 \{}
\DoxyCodeLine{238 \}}
\DoxyCodeLine{239 }
\DoxyCodeLine{240 \textcolor{keyword}{template} <\textcolor{keyword}{typename} FloatType>}
\DoxyCodeLine{241 \mbox{\hyperlink{classtesseract__planning_1_1MotionPlanner_a5b4a8c1043a08c4dd022240333a5ee36}{MotionPlanner::Ptr}} \mbox{\hyperlink{classtesseract__planning_1_1DescartesMotionPlanner_a9ad1370efee697b369cf98ea6a3143ae}{DescartesMotionPlanner<FloatType>::clone}}()\textcolor{keyword}{ const}}
\DoxyCodeLine{242 \textcolor{keyword}{}\{}
\DoxyCodeLine{243   \textcolor{keywordflow}{return} std::make\_shared<DescartesMotionPlanner<FloatType>>(name\_);}
\DoxyCodeLine{244 \}}
\DoxyCodeLine{245 }
\DoxyCodeLine{246 \textcolor{keyword}{template} <\textcolor{keyword}{typename} FloatType>}
\DoxyCodeLine{247 std::shared\_ptr<DescartesProblem<FloatType>>}
\DoxyCodeLine{248 \mbox{\hyperlink{classtesseract__planning_1_1DescartesMotionPlanner_a7aa5051004a8c999fa46cbc087a09db2}{DescartesMotionPlanner<FloatType>::createProblem}}(\textcolor{keyword}{const} \mbox{\hyperlink{structtesseract__planning_1_1PlannerRequest}{PlannerRequest}}\& request)\textcolor{keyword}{ const}}
\DoxyCodeLine{249 \textcolor{keyword}{}\{}
\DoxyCodeLine{250   \textcolor{keyword}{auto} prob = std::make\_shared<DescartesProblem<FloatType>>();}
\DoxyCodeLine{251 }
\DoxyCodeLine{252   \textcolor{comment}{// Clear descartes data}}
\DoxyCodeLine{253   prob-\/>edge\_evaluators.clear();}
\DoxyCodeLine{254   prob-\/>samplers.clear();}
\DoxyCodeLine{255   prob-\/>state\_evaluators.clear();}
\DoxyCodeLine{256 }
\DoxyCodeLine{257   \textcolor{comment}{// Assume all the plan instructions have the same manipulator as the composite}}
\DoxyCodeLine{258   assert(!request.\mbox{\hyperlink{structtesseract__planning_1_1PlannerRequest_a8c6a68b833fbe425b10ff295be07cff7}{instructions}}.\mbox{\hyperlink{classtesseract__planning_1_1CompositeInstruction_a4e5a5164dba8c07ad50bfbdc0a6de6cd}{getManipulatorInfo}}().empty());}
\DoxyCodeLine{259   \textcolor{keyword}{const} \mbox{\hyperlink{namespacetesseract__planning_aa96fe6a7234303baeef3b4a8afcedfc4}{ManipulatorInfo}}\& composite\_mi = request.\mbox{\hyperlink{structtesseract__planning_1_1PlannerRequest_a8c6a68b833fbe425b10ff295be07cff7}{instructions}}.\mbox{\hyperlink{classtesseract__planning_1_1CompositeInstruction_a4e5a5164dba8c07ad50bfbdc0a6de6cd}{getManipulatorInfo}}();}
\DoxyCodeLine{260 }
\DoxyCodeLine{261   \textcolor{keywordflow}{if} (composite\_mi.manipulator.empty())}
\DoxyCodeLine{262     \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"{}Descartes, manipulator is empty!"{}});}
\DoxyCodeLine{263 }
\DoxyCodeLine{264   \textcolor{comment}{// Get Manipulator Information}}
\DoxyCodeLine{265   \textcolor{keywordflow}{try}}
\DoxyCodeLine{266   \{}
\DoxyCodeLine{267     \textcolor{keywordflow}{if} (composite\_mi.manipulator\_ik\_solver.empty())}
\DoxyCodeLine{268       prob-\/>manip = request.\mbox{\hyperlink{structtesseract__planning_1_1PlannerRequest_a2808ed97d04b1681ec4b5b7c5b3155f0}{env}}-\/>getKinematicGroup(composite\_mi.manipulator);}
\DoxyCodeLine{269     \textcolor{keywordflow}{else}}
\DoxyCodeLine{270       prob-\/>manip = request.\mbox{\hyperlink{structtesseract__planning_1_1PlannerRequest_a2808ed97d04b1681ec4b5b7c5b3155f0}{env}}-\/>getKinematicGroup(composite\_mi.manipulator, composite\_mi.manipulator\_ik\_solver);}
\DoxyCodeLine{271   \}}
\DoxyCodeLine{272   \textcolor{keywordflow}{catch} (...)}
\DoxyCodeLine{273   \{}
\DoxyCodeLine{274     \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"{}Descartes problem generator failed to create kinematic group!"{}});}
\DoxyCodeLine{275   \}}
\DoxyCodeLine{276 }
\DoxyCodeLine{277   \textcolor{keywordflow}{if} (!prob-\/>manip)}
\DoxyCodeLine{278   \{}
\DoxyCodeLine{279     CONSOLE\_BRIDGE\_logError(\textcolor{stringliteral}{"{}No Kinematics Group found"{}});}
\DoxyCodeLine{280     \textcolor{keywordflow}{return} prob;}
\DoxyCodeLine{281   \}}
\DoxyCodeLine{282 }
\DoxyCodeLine{283   prob-\/>env\_state = request.\mbox{\hyperlink{structtesseract__planning_1_1PlannerRequest_a15896a8c7bd1050d934da96ab05c27b2}{env\_state}};}
\DoxyCodeLine{284   prob-\/>env = request.\mbox{\hyperlink{structtesseract__planning_1_1PlannerRequest_a2808ed97d04b1681ec4b5b7c5b3155f0}{env}};}
\DoxyCodeLine{285 }
\DoxyCodeLine{286   std::vector<std::string> joint\_names = prob-\/>manip-\/>getJointNames();}
\DoxyCodeLine{287 }
\DoxyCodeLine{288   \textcolor{comment}{// Flatten the input for planning}}
\DoxyCodeLine{289   \textcolor{keyword}{auto} instructions\_flat = \mbox{\hyperlink{namespacetesseract__planning_a1172c93ff97196d2037dc67a853c0625}{flattenProgram}}(request.\mbox{\hyperlink{structtesseract__planning_1_1PlannerRequest_a8c6a68b833fbe425b10ff295be07cff7}{instructions}});}
\DoxyCodeLine{290   \textcolor{keyword}{auto} seed\_flat = \mbox{\hyperlink{namespacetesseract__planning_a376b0dd548ca385a3128afc20bdc1dca}{flattenProgramToPattern}}(request.\mbox{\hyperlink{structtesseract__planning_1_1PlannerRequest_a610e5a50fcb3b62f94b085072170669f}{seed}}, request.\mbox{\hyperlink{structtesseract__planning_1_1PlannerRequest_a8c6a68b833fbe425b10ff295be07cff7}{instructions}});}
\DoxyCodeLine{291 }
\DoxyCodeLine{292   std::size\_t start\_index = 0;  \textcolor{comment}{// If it has a start instruction then skip first instruction in instructions\_flat}}
\DoxyCodeLine{293   \textcolor{keywordtype}{int} index = 0;}
\DoxyCodeLine{294   std::string profile;}
\DoxyCodeLine{295   \mbox{\hyperlink{classtesseract__planning_1_1ProfileDictionary_ab9e6bb9185d333d45264d7c17c636bb4}{ProfileDictionary::ConstPtr}} profile\_overrides;}
\DoxyCodeLine{296   \mbox{\hyperlink{structtesseract__planning_1_1Waypoint}{Waypoint}} start\_waypoint\{ \mbox{\hyperlink{classtesseract__planning_1_1NullWaypoint}{NullWaypoint}}() \};}
\DoxyCodeLine{297   \mbox{\hyperlink{structtesseract__planning_1_1Instruction}{Instruction}} placeholder\_instruction\{ \mbox{\hyperlink{classtesseract__planning_1_1NullInstruction}{NullInstruction}}() \};}
\DoxyCodeLine{298   \textcolor{keyword}{const} \mbox{\hyperlink{structtesseract__planning_1_1Instruction}{Instruction}}* start\_instruction = \textcolor{keyword}{nullptr};}
\DoxyCodeLine{299   \textcolor{keywordflow}{if} (request.\mbox{\hyperlink{structtesseract__planning_1_1PlannerRequest_a8c6a68b833fbe425b10ff295be07cff7}{instructions}}.\mbox{\hyperlink{classtesseract__planning_1_1CompositeInstruction_ae2160219a45049b04b5fdf68bd27e882}{hasStartInstruction}}())}
\DoxyCodeLine{300   \{}
\DoxyCodeLine{301     assert(\mbox{\hyperlink{namespacetesseract__planning_a7c15fced3d0a2819bef3c874d85b1f8f}{isPlanInstruction}}(request.\mbox{\hyperlink{structtesseract__planning_1_1PlannerRequest_a8c6a68b833fbe425b10ff295be07cff7}{instructions}}.\mbox{\hyperlink{classtesseract__planning_1_1CompositeInstruction_abf2e38f4f1b149032ddfa260165b24c2}{getStartInstruction}}()));}
\DoxyCodeLine{302     start\_instruction = \&(request.\mbox{\hyperlink{structtesseract__planning_1_1PlannerRequest_a8c6a68b833fbe425b10ff295be07cff7}{instructions}}.\mbox{\hyperlink{classtesseract__planning_1_1CompositeInstruction_abf2e38f4f1b149032ddfa260165b24c2}{getStartInstruction}}());}
\DoxyCodeLine{303     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacetesseract__planning_a7c15fced3d0a2819bef3c874d85b1f8f}{isPlanInstruction}}(*start\_instruction))}
\DoxyCodeLine{304     \{}
\DoxyCodeLine{305       \textcolor{keyword}{const} \textcolor{keyword}{auto}\& temp = start\_instruction-\/>as<\mbox{\hyperlink{classtesseract__planning_1_1PlanInstruction}{PlanInstruction}}>();}
\DoxyCodeLine{306       assert(temp.isStart());}
\DoxyCodeLine{307       start\_waypoint = temp.getWaypoint();}
\DoxyCodeLine{308       profile = temp.getProfile();}
\DoxyCodeLine{309       profile\_overrides = temp.profile\_overrides;}
\DoxyCodeLine{310     \}}
\DoxyCodeLine{311     \textcolor{keywordflow}{else}}
\DoxyCodeLine{312     \{}
\DoxyCodeLine{313       \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"{}Descartes DefaultProblemGenerator: Unsupported start instruction type!"{}});}
\DoxyCodeLine{314     \}}
\DoxyCodeLine{315     ++start\_index;}
\DoxyCodeLine{316   \}}
\DoxyCodeLine{317   \textcolor{keywordflow}{else}}
\DoxyCodeLine{318   \{}
\DoxyCodeLine{319     Eigen::VectorXd current\_jv\{ request.\mbox{\hyperlink{structtesseract__planning_1_1PlannerRequest_a15896a8c7bd1050d934da96ab05c27b2}{env\_state}}.getJointValues(joint\_names) \};}
\DoxyCodeLine{320     \mbox{\hyperlink{classtesseract__planning_1_1StateWaypoint}{StateWaypoint}} swp(joint\_names, current\_jv);}
\DoxyCodeLine{321 }
\DoxyCodeLine{322     \mbox{\hyperlink{classtesseract__planning_1_1MoveInstruction}{MoveInstruction}} temp\_move(swp, \mbox{\hyperlink{namespacetesseract__planning_acdeb2344747f1fe9d0825bf09e0da7acab078ffd28db767c502ac367053f6e0ac}{MoveInstructionType::START}});}
\DoxyCodeLine{323     placeholder\_instruction = temp\_move;}
\DoxyCodeLine{324     start\_instruction = \&placeholder\_instruction;}
\DoxyCodeLine{325     start\_waypoint = swp;}
\DoxyCodeLine{326   \}}
\DoxyCodeLine{327 }
\DoxyCodeLine{328   profile = \mbox{\hyperlink{namespacetesseract__planning_a4c2dd8bf456bf47e36e6777ac7f3e513}{getProfileString}}(name\_, profile, request.\mbox{\hyperlink{structtesseract__planning_1_1PlannerRequest_ae5b187f9c9a824bda4236bfe61b454af}{plan\_profile\_remapping}});}
\DoxyCodeLine{329   \textcolor{keyword}{auto} cur\_plan\_profile = getProfile<DescartesPlanProfile<FloatType>>(}
\DoxyCodeLine{330       name\_, profile, *request.\mbox{\hyperlink{structtesseract__planning_1_1PlannerRequest_a404ef354039b6f99003a026f71a4cbc1}{profiles}}, std::make\_shared<DescartesDefaultPlanProfile<FloatType>>());}
\DoxyCodeLine{331   cur\_plan\_profile = \mbox{\hyperlink{namespacetesseract__planning_abc4e0abb003d616199f38f74bdad6421}{applyProfileOverrides}}(name\_, profile, cur\_plan\_profile, profile\_overrides);}
\DoxyCodeLine{332   \textcolor{keywordflow}{if} (!cur\_plan\_profile)}
\DoxyCodeLine{333     \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"{}DescartesMotionPlannerConfig: Invalid profile"{}});}
\DoxyCodeLine{334 }
\DoxyCodeLine{335   \textcolor{comment}{// Add start waypoint}}
\DoxyCodeLine{336   \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacetesseract__planning_aa1979ee1643c64f94a0fca7bc64dd455}{isCartesianWaypoint}}(start\_waypoint))}
\DoxyCodeLine{337   \{}
\DoxyCodeLine{338     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& cwp = start\_waypoint.as<\mbox{\hyperlink{classtesseract__planning_1_1CartesianWaypoint}{CartesianWaypoint}}>();}
\DoxyCodeLine{339     cur\_plan\_profile-\/>apply(*prob, cwp.waypoint, *start\_instruction, composite\_mi, index);}
\DoxyCodeLine{340   \}}
\DoxyCodeLine{341   \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacetesseract__planning_ac2bb55bed2473cb51b560386fdc27f0d}{isJointWaypoint}}(start\_waypoint) || \mbox{\hyperlink{namespacetesseract__planning_aa10501c754ee26532985c02677b4d12d}{isStateWaypoint}}(start\_waypoint))}
\DoxyCodeLine{342   \{}
\DoxyCodeLine{343     assert(\mbox{\hyperlink{namespacetesseract__planning_aabbbd76f430add29f5caf0582fe6df6e}{checkJointPositionFormat}}(joint\_names, start\_waypoint));}
\DoxyCodeLine{344     \textcolor{keyword}{const} Eigen::VectorXd\& position = \mbox{\hyperlink{namespacetesseract__planning_a48d0e84f52079854d947f2f7f058d7ad}{getJointPosition}}(start\_waypoint);}
\DoxyCodeLine{345     cur\_plan\_profile-\/>apply(*prob, position, *start\_instruction, composite\_mi, index);}
\DoxyCodeLine{346   \}}
\DoxyCodeLine{347   \textcolor{keywordflow}{else}}
\DoxyCodeLine{348   \{}
\DoxyCodeLine{349     \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"{}DescartesMotionPlannerConfig: unknown waypoint type."{}});}
\DoxyCodeLine{350   \}}
\DoxyCodeLine{351 }
\DoxyCodeLine{352   ++index;}
\DoxyCodeLine{353 }
\DoxyCodeLine{354   \textcolor{comment}{// Transform plan instructions into descartes samplers}}
\DoxyCodeLine{355   \textcolor{keywordflow}{for} (std::size\_t i = start\_index; i < instructions\_flat.size(); ++i)}
\DoxyCodeLine{356   \{}
\DoxyCodeLine{357     \textcolor{keyword}{const} \textcolor{keyword}{auto}\& instruction = instructions\_flat[i].get();}
\DoxyCodeLine{358     \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacetesseract__planning_a7c15fced3d0a2819bef3c874d85b1f8f}{isPlanInstruction}}(instruction))}
\DoxyCodeLine{359     \{}
\DoxyCodeLine{360       assert(\mbox{\hyperlink{namespacetesseract__planning_a7c15fced3d0a2819bef3c874d85b1f8f}{isPlanInstruction}}(instruction));}
\DoxyCodeLine{361       \textcolor{keyword}{const} \textcolor{keyword}{auto}\& plan\_instruction = instruction.template as<PlanInstruction>();}
\DoxyCodeLine{362 }
\DoxyCodeLine{363       \textcolor{comment}{// If plan instruction has manipulator information then use it over the one provided by the composite.}}
\DoxyCodeLine{364       \mbox{\hyperlink{namespacetesseract__planning_aa96fe6a7234303baeef3b4a8afcedfc4}{ManipulatorInfo}} mi = composite\_mi.getCombined(plan\_instruction.getManipulatorInfo());}
\DoxyCodeLine{365 }
\DoxyCodeLine{366       \textcolor{keywordflow}{if} (mi.manipulator.empty())}
\DoxyCodeLine{367         \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"{}Descartes, manipulator is empty!"{}});}
\DoxyCodeLine{368 }
\DoxyCodeLine{369       \textcolor{keywordflow}{if} (mi.tcp\_frame.empty())}
\DoxyCodeLine{370         \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"{}Descartes, tcp\_frame is empty!"{}});}
\DoxyCodeLine{371 }
\DoxyCodeLine{372       \textcolor{keywordflow}{if} (mi.working\_frame.empty())}
\DoxyCodeLine{373         \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"{}Descartes, working\_frame is empty!"{}});}
\DoxyCodeLine{374 }
\DoxyCodeLine{375       Eigen::Isometry3d tcp\_offset = request.\mbox{\hyperlink{structtesseract__planning_1_1PlannerRequest_a2808ed97d04b1681ec4b5b7c5b3155f0}{env}}-\/>findTCPOffset(mi);}
\DoxyCodeLine{376 }
\DoxyCodeLine{377       \textcolor{comment}{// The seed should always have a start instruction}}
\DoxyCodeLine{378       assert(request.\mbox{\hyperlink{structtesseract__planning_1_1PlannerRequest_a610e5a50fcb3b62f94b085072170669f}{seed}}.\mbox{\hyperlink{classtesseract__planning_1_1CompositeInstruction_ae2160219a45049b04b5fdf68bd27e882}{hasStartInstruction}}());}
\DoxyCodeLine{379       std::size\_t seed\_idx = (start\_index == 0) ? i + 1 : i;}
\DoxyCodeLine{380       assert(\mbox{\hyperlink{namespacetesseract__planning_af48bb1d750c019e34337ed0a0f88ef76}{isCompositeInstruction}}(seed\_flat[seed\_idx].get()));}
\DoxyCodeLine{381       \textcolor{keyword}{const} \textcolor{keyword}{auto}\& seed\_composite = seed\_flat[seed\_idx].get().template as<tesseract\_planning::CompositeInstruction>();}
\DoxyCodeLine{382       \textcolor{keyword}{auto} interpolate\_cnt = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(seed\_composite.size());}
\DoxyCodeLine{383 }
\DoxyCodeLine{384       \textcolor{comment}{// Get Plan Profile}}
\DoxyCodeLine{385       std::string profile = plan\_instruction.getProfile();}
\DoxyCodeLine{386       profile = \mbox{\hyperlink{namespacetesseract__planning_a4c2dd8bf456bf47e36e6777ac7f3e513}{getProfileString}}(name\_, profile, request.\mbox{\hyperlink{structtesseract__planning_1_1PlannerRequest_ae5b187f9c9a824bda4236bfe61b454af}{plan\_profile\_remapping}});}
\DoxyCodeLine{387       \textcolor{keyword}{auto} cur\_plan\_profile = getProfile<DescartesPlanProfile<FloatType>>(}
\DoxyCodeLine{388           name\_, profile, *request.\mbox{\hyperlink{structtesseract__planning_1_1PlannerRequest_a404ef354039b6f99003a026f71a4cbc1}{profiles}}, std::make\_shared<DescartesDefaultPlanProfile<FloatType>>());}
\DoxyCodeLine{389       cur\_plan\_profile = \mbox{\hyperlink{namespacetesseract__planning_abc4e0abb003d616199f38f74bdad6421}{applyProfileOverrides}}(name\_, profile, cur\_plan\_profile, plan\_instruction.profile\_overrides);}
\DoxyCodeLine{390       \textcolor{keywordflow}{if} (!cur\_plan\_profile)}
\DoxyCodeLine{391         \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"{}DescartesMotionPlannerConfig: Invalid profile"{}});}
\DoxyCodeLine{392 }
\DoxyCodeLine{393       \textcolor{comment}{// Get Plan Path Profile: Default is an empty string}}
\DoxyCodeLine{394       std::string path\_profile = plan\_instruction.getPathProfile();}
\DoxyCodeLine{395       path\_profile = \mbox{\hyperlink{namespacetesseract__planning_a4c2dd8bf456bf47e36e6777ac7f3e513}{getProfileString}}(name\_, path\_profile, request.\mbox{\hyperlink{structtesseract__planning_1_1PlannerRequest_ae5b187f9c9a824bda4236bfe61b454af}{plan\_profile\_remapping}}, \textcolor{stringliteral}{"{}"{}});}
\DoxyCodeLine{396 }
\DoxyCodeLine{397       \textcolor{keywordflow}{if} (plan\_instruction.isLinear())}
\DoxyCodeLine{398       \{}
\DoxyCodeLine{399         \textcolor{keyword}{auto} cur\_path\_plan\_profile = getProfile<DescartesPlanProfile<FloatType>>(}
\DoxyCodeLine{400             name\_, path\_profile, *request.\mbox{\hyperlink{structtesseract__planning_1_1PlannerRequest_a404ef354039b6f99003a026f71a4cbc1}{profiles}}, std::make\_shared<DescartesDefaultPlanProfile<FloatType>>());}
\DoxyCodeLine{401         cur\_path\_plan\_profile =}
\DoxyCodeLine{402             \mbox{\hyperlink{namespacetesseract__planning_abc4e0abb003d616199f38f74bdad6421}{applyProfileOverrides}}(name\_, path\_profile, cur\_path\_plan\_profile, plan\_instruction.profile\_overrides);}
\DoxyCodeLine{403         \textcolor{keywordflow}{if} (!cur\_path\_plan\_profile)}
\DoxyCodeLine{404           \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"{}DescartesMotionPlannerConfig: Invalid transition profile"{}});}
\DoxyCodeLine{405 }
\DoxyCodeLine{406         \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacetesseract__planning_aa1979ee1643c64f94a0fca7bc64dd455}{isCartesianWaypoint}}(plan\_instruction.getWaypoint()))}
\DoxyCodeLine{407         \{}
\DoxyCodeLine{408           \textcolor{keyword}{const} \textcolor{keyword}{auto}\& cur\_wp = plan\_instruction.getWaypoint().template as<tesseract\_planning::CartesianWaypoint>();}
\DoxyCodeLine{409 }
\DoxyCodeLine{410           Eigen::Isometry3d prev\_pose = Eigen::Isometry3d::Identity();}
\DoxyCodeLine{411           \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacetesseract__planning_aa1979ee1643c64f94a0fca7bc64dd455}{isCartesianWaypoint}}(start\_waypoint))}
\DoxyCodeLine{412           \{}
\DoxyCodeLine{413             prev\_pose = start\_waypoint.as<\mbox{\hyperlink{classtesseract__planning_1_1CartesianWaypoint}{CartesianWaypoint}}>().waypoint;}
\DoxyCodeLine{414           \}}
\DoxyCodeLine{415           \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacetesseract__planning_ac2bb55bed2473cb51b560386fdc27f0d}{isJointWaypoint}}(start\_waypoint) || \mbox{\hyperlink{namespacetesseract__planning_aa10501c754ee26532985c02677b4d12d}{isStateWaypoint}}(start\_waypoint))}
\DoxyCodeLine{416           \{}
\DoxyCodeLine{417             assert(\mbox{\hyperlink{namespacetesseract__planning_aabbbd76f430add29f5caf0582fe6df6e}{checkJointPositionFormat}}(joint\_names, start\_waypoint));}
\DoxyCodeLine{418             \textcolor{keyword}{const} Eigen::VectorXd\& position = \mbox{\hyperlink{namespacetesseract__planning_a48d0e84f52079854d947f2f7f058d7ad}{getJointPosition}}(start\_waypoint);}
\DoxyCodeLine{419             prev\_pose = prob-\/>manip-\/>calcFwdKin(position)[mi.tcp\_frame] * tcp\_offset;}
\DoxyCodeLine{420           \}}
\DoxyCodeLine{421           \textcolor{keywordflow}{else}}
\DoxyCodeLine{422           \{}
\DoxyCodeLine{423             \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"{}DescartesMotionPlannerConfig: unknown waypoint type."{}});}
\DoxyCodeLine{424           \}}
\DoxyCodeLine{425 }
\DoxyCodeLine{426           tesseract\_common::VectorIsometry3d poses = \mbox{\hyperlink{namespacetesseract__planning_a71ea10c42f51ae6e4d014ad054c900f6}{interpolate}}(prev\_pose, cur\_wp, interpolate\_cnt);}
\DoxyCodeLine{427           \textcolor{comment}{// Add intermediate points with path costs and constraints}}
\DoxyCodeLine{428           \textcolor{keywordflow}{for} (std::size\_t p = 1; p < poses.size() -\/ 1; ++p)}
\DoxyCodeLine{429           \{}
\DoxyCodeLine{430             cur\_path\_plan\_profile-\/>apply(*prob, poses[p], plan\_instruction, composite\_mi, index);}
\DoxyCodeLine{431 }
\DoxyCodeLine{432             ++index;}
\DoxyCodeLine{433           \}}
\DoxyCodeLine{434 }
\DoxyCodeLine{435           \textcolor{comment}{// Add final point with waypoint}}
\DoxyCodeLine{436           cur\_plan\_profile-\/>apply(*prob, cur\_wp, plan\_instruction, composite\_mi, index);}
\DoxyCodeLine{437 }
\DoxyCodeLine{438           ++index;}
\DoxyCodeLine{439         \}}
\DoxyCodeLine{440         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacetesseract__planning_ac2bb55bed2473cb51b560386fdc27f0d}{isJointWaypoint}}(plan\_instruction.getWaypoint()) || \mbox{\hyperlink{namespacetesseract__planning_aa10501c754ee26532985c02677b4d12d}{isStateWaypoint}}(plan\_instruction.getWaypoint()))}
\DoxyCodeLine{441         \{}
\DoxyCodeLine{442           assert(\mbox{\hyperlink{namespacetesseract__planning_aabbbd76f430add29f5caf0582fe6df6e}{checkJointPositionFormat}}(joint\_names, plan\_instruction.getWaypoint()));}
\DoxyCodeLine{443           \textcolor{keyword}{const} Eigen::VectorXd\& cur\_position = \mbox{\hyperlink{namespacetesseract__planning_a48d0e84f52079854d947f2f7f058d7ad}{getJointPosition}}(plan\_instruction.getWaypoint());}
\DoxyCodeLine{444           Eigen::Isometry3d cur\_pose = prob-\/>manip-\/>calcFwdKin(cur\_position)[mi.tcp\_frame] * tcp\_offset;}
\DoxyCodeLine{445 }
\DoxyCodeLine{446           Eigen::Isometry3d prev\_pose = Eigen::Isometry3d::Identity();}
\DoxyCodeLine{447           \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacetesseract__planning_aa1979ee1643c64f94a0fca7bc64dd455}{isCartesianWaypoint}}(start\_waypoint))}
\DoxyCodeLine{448           \{}
\DoxyCodeLine{449             prev\_pose = start\_waypoint.as<\mbox{\hyperlink{classtesseract__planning_1_1CartesianWaypoint}{CartesianWaypoint}}>().waypoint;}
\DoxyCodeLine{450           \}}
\DoxyCodeLine{451           \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacetesseract__planning_ac2bb55bed2473cb51b560386fdc27f0d}{isJointWaypoint}}(start\_waypoint) || \mbox{\hyperlink{namespacetesseract__planning_aa10501c754ee26532985c02677b4d12d}{isStateWaypoint}}(start\_waypoint))}
\DoxyCodeLine{452           \{}
\DoxyCodeLine{453             assert(\mbox{\hyperlink{namespacetesseract__planning_aabbbd76f430add29f5caf0582fe6df6e}{checkJointPositionFormat}}(joint\_names, start\_waypoint));}
\DoxyCodeLine{454             \textcolor{keyword}{const} Eigen::VectorXd\& position = \mbox{\hyperlink{namespacetesseract__planning_a48d0e84f52079854d947f2f7f058d7ad}{getJointPosition}}(start\_waypoint);}
\DoxyCodeLine{455             prev\_pose = prob-\/>manip-\/>calcFwdKin(position)[mi.tcp\_frame] * tcp\_offset;}
\DoxyCodeLine{456           \}}
\DoxyCodeLine{457           \textcolor{keywordflow}{else}}
\DoxyCodeLine{458           \{}
\DoxyCodeLine{459             \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"{}DescartesMotionPlannerConfig: unknown waypoint type."{}});}
\DoxyCodeLine{460           \}}
\DoxyCodeLine{461 }
\DoxyCodeLine{462           tesseract\_common::VectorIsometry3d poses = \mbox{\hyperlink{namespacetesseract__planning_a71ea10c42f51ae6e4d014ad054c900f6}{interpolate}}(prev\_pose, cur\_pose, interpolate\_cnt);}
\DoxyCodeLine{463           \textcolor{comment}{// Add intermediate points with path costs and constraints}}
\DoxyCodeLine{464           \textcolor{keywordflow}{for} (std::size\_t p = 1; p < poses.size() -\/ 1; ++p)}
\DoxyCodeLine{465           \{}
\DoxyCodeLine{466             cur\_path\_plan\_profile-\/>apply(*prob, poses[p], plan\_instruction, composite\_mi, index);}
\DoxyCodeLine{467 }
\DoxyCodeLine{468             ++index;}
\DoxyCodeLine{469           \}}
\DoxyCodeLine{470 }
\DoxyCodeLine{471           \textcolor{comment}{// Add final point with waypoint}}
\DoxyCodeLine{472           cur\_plan\_profile-\/>apply(*prob, cur\_position, plan\_instruction, composite\_mi, index);}
\DoxyCodeLine{473 }
\DoxyCodeLine{474           ++index;}
\DoxyCodeLine{475         \}}
\DoxyCodeLine{476         \textcolor{keywordflow}{else}}
\DoxyCodeLine{477         \{}
\DoxyCodeLine{478           \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"{}DescartesMotionPlannerConfig: unknown waypoint type"{}});}
\DoxyCodeLine{479         \}}
\DoxyCodeLine{480       \}}
\DoxyCodeLine{481       \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (plan\_instruction.isFreespace())}
\DoxyCodeLine{482       \{}
\DoxyCodeLine{483         \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacetesseract__planning_ac2bb55bed2473cb51b560386fdc27f0d}{isJointWaypoint}}(plan\_instruction.getWaypoint()) || \mbox{\hyperlink{namespacetesseract__planning_aa10501c754ee26532985c02677b4d12d}{isStateWaypoint}}(plan\_instruction.getWaypoint()))}
\DoxyCodeLine{484         \{}
\DoxyCodeLine{485           assert(\mbox{\hyperlink{namespacetesseract__planning_aabbbd76f430add29f5caf0582fe6df6e}{checkJointPositionFormat}}(joint\_names, plan\_instruction.getWaypoint()));}
\DoxyCodeLine{486           \textcolor{keyword}{const} Eigen::VectorXd\& cur\_position = \mbox{\hyperlink{namespacetesseract__planning_a48d0e84f52079854d947f2f7f058d7ad}{getJointPosition}}(plan\_instruction.getWaypoint());}
\DoxyCodeLine{487 }
\DoxyCodeLine{488           \textcolor{comment}{// Descartes does not support freespace so it will only include the plan instruction state, then in}}
\DoxyCodeLine{489           \textcolor{comment}{// post processing function will perform interpolation to fill out the seed, but may be in collision.}}
\DoxyCodeLine{490           \textcolor{comment}{// Usually this is only requested when it is being provided as a seed to a planner like trajopt.}}
\DoxyCodeLine{491 }
\DoxyCodeLine{492           \textcolor{comment}{// Add final point with waypoint costs and constraints}}
\DoxyCodeLine{494 \textcolor{comment}{}          cur\_plan\_profile-\/>apply(*prob, cur\_position, plan\_instruction, composite\_mi, index);}
\DoxyCodeLine{495 }
\DoxyCodeLine{496           ++index;}
\DoxyCodeLine{497         \}}
\DoxyCodeLine{498         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\mbox{\hyperlink{namespacetesseract__planning_aa1979ee1643c64f94a0fca7bc64dd455}{isCartesianWaypoint}}(plan\_instruction.getWaypoint()))}
\DoxyCodeLine{499         \{}
\DoxyCodeLine{500           \textcolor{keyword}{const} \textcolor{keyword}{auto}\& cur\_wp = plan\_instruction.getWaypoint().template as<tesseract\_planning::CartesianWaypoint>();}
\DoxyCodeLine{501 }
\DoxyCodeLine{502           \textcolor{comment}{// Descartes does not support freespace so it will only include the plan instruction state, then in}}
\DoxyCodeLine{503           \textcolor{comment}{// post processing function will perform interpolation to fill out the seed, but may be in collision.}}
\DoxyCodeLine{504           \textcolor{comment}{// Usually this is only requested when it is being provided as a seed to a planner like trajopt.}}
\DoxyCodeLine{505 }
\DoxyCodeLine{506           \textcolor{comment}{// Add final point with waypoint costs and constraints}}
\DoxyCodeLine{508 \textcolor{comment}{}          cur\_plan\_profile-\/>apply(*prob, cur\_wp, plan\_instruction, composite\_mi, index);}
\DoxyCodeLine{509 }
\DoxyCodeLine{510           ++index;}
\DoxyCodeLine{511         \}}
\DoxyCodeLine{512         \textcolor{keywordflow}{else}}
\DoxyCodeLine{513         \{}
\DoxyCodeLine{514           \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"{}DescartesMotionPlannerConfig: unknown waypoint type"{}});}
\DoxyCodeLine{515         \}}
\DoxyCodeLine{516       \}}
\DoxyCodeLine{517       \textcolor{keywordflow}{else}}
\DoxyCodeLine{518       \{}
\DoxyCodeLine{519         \textcolor{keywordflow}{throw} std::runtime\_error(\textcolor{stringliteral}{"{}DescartesMotionPlannerConfig: Unsupported!"{}});}
\DoxyCodeLine{520       \}}
\DoxyCodeLine{521 }
\DoxyCodeLine{522       start\_waypoint = plan\_instruction.getWaypoint();}
\DoxyCodeLine{523       start\_instruction = \&instruction;}
\DoxyCodeLine{524     \}}
\DoxyCodeLine{525   \}}
\DoxyCodeLine{526 }
\DoxyCodeLine{527   \textcolor{comment}{// Call the base class generate which checks the problem to make sure everything is in order}}
\DoxyCodeLine{528   \textcolor{keywordflow}{return} prob;}
\DoxyCodeLine{529 \}}
\DoxyCodeLine{530 }
\DoxyCodeLine{531 \}  \textcolor{comment}{// namespace tesseract\_planning}}
\DoxyCodeLine{532 \textcolor{preprocessor}{\#endif  }\textcolor{comment}{// TESSERACT\_MOTION\_PLANNERS\_IMPL\_DESCARTES\_DECARTES\_MOTION\_PLANNER\_HPP}}

\end{DoxyCode}
