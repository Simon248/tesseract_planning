\hypertarget{tesseract__time__parameterization_2include_2tesseract__time__parameterization_2utils_8h_source}{}\doxysection{utils.\+h}
\label{tesseract__time__parameterization_2include_2tesseract__time__parameterization_2utils_8h_source}\index{tesseract\_time\_parameterization/include/tesseract\_time\_parameterization/utils.h@{tesseract\_time\_parameterization/include/tesseract\_time\_parameterization/utils.h}}
\mbox{\hyperlink{tesseract__time__parameterization_2include_2tesseract__time__parameterization_2utils_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 }
\DoxyCodeLine{24 \textcolor{preprocessor}{\#ifndef TESSERACT\_TIME\_PARAMETERIZATION\_UTILS\_H}}
\DoxyCodeLine{25 \textcolor{preprocessor}{\#define TESSERACT\_TIME\_PARAMETERIZATION\_UTILS\_H}}
\DoxyCodeLine{26 }
\DoxyCodeLine{27 \textcolor{preprocessor}{\#include <tesseract\_common/macros.h>}}
\DoxyCodeLine{28 TESSERACT\_COMMON\_IGNORE\_WARNINGS\_PUSH}
\DoxyCodeLine{29 \textcolor{preprocessor}{\#include <Eigen/Eigen>}}
\DoxyCodeLine{30 \textcolor{preprocessor}{\#include <console\_bridge/console.h>}}
\DoxyCodeLine{31 TESSERACT\_COMMON\_IGNORE\_WARNINGS\_POP}
\DoxyCodeLine{32 }
\DoxyCodeLine{33 \textcolor{preprocessor}{\#include <\mbox{\hyperlink{composite__instruction_8h}{tesseract\_command\_language/composite\_instruction.h}}>}}
\DoxyCodeLine{34 }
\DoxyCodeLine{35 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacetesseract__planning}{tesseract\_planning}}}
\DoxyCodeLine{36 \{}
\DoxyCodeLine{44 \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \mbox{\hyperlink{namespacetesseract__planning_a8c98bef4d1dd9386473cc9c4eebaacd7}{RescaleTimings}}(\mbox{\hyperlink{classtesseract__planning_1_1CompositeInstruction}{CompositeInstruction}}\& program, std::vector<double> scalings)}
\DoxyCodeLine{45 \{}
\DoxyCodeLine{46   assert(program.\mbox{\hyperlink{classtesseract__planning_1_1CompositeInstruction_a152d0e323ef91226498dc982c8af3724}{size}}() == scalings.size());}
\DoxyCodeLine{47 }
\DoxyCodeLine{48   \textcolor{keywordtype}{double} prev\_time\_scaled = 0;}
\DoxyCodeLine{49   \textcolor{keywordtype}{double} prev\_time\_original = 0;}
\DoxyCodeLine{50   \textcolor{keywordflow}{for} (std::size\_t sub\_composite\_idx = 0; sub\_composite\_idx < program.\mbox{\hyperlink{classtesseract__planning_1_1CompositeInstruction_a152d0e323ef91226498dc982c8af3724}{size}}(); sub\_composite\_idx++)}
\DoxyCodeLine{51   \{}
\DoxyCodeLine{52     \mbox{\hyperlink{classtesseract__planning_1_1CompositeInstruction}{CompositeInstruction}}\& sub = program[sub\_composite\_idx].as<\mbox{\hyperlink{classtesseract__planning_1_1CompositeInstruction}{CompositeInstruction}}>();}
\DoxyCodeLine{53     \textcolor{keywordflow}{for} (std::size\_t move\_idx = 0; move\_idx < sub.\mbox{\hyperlink{classtesseract__planning_1_1CompositeInstruction_a152d0e323ef91226498dc982c8af3724}{size}}(); move\_idx++)}
\DoxyCodeLine{54     \{}
\DoxyCodeLine{55       \textcolor{keywordflow}{if} (sub.\mbox{\hyperlink{classtesseract__planning_1_1CompositeInstruction_a42076f07a201bdee759baa5a37596ff3}{at}}(move\_idx).isMoveInstruction())}
\DoxyCodeLine{56       \{}
\DoxyCodeLine{57         \textcolor{keyword}{auto}\& move = sub.\mbox{\hyperlink{classtesseract__planning_1_1CompositeInstruction_a42076f07a201bdee759baa5a37596ff3}{at}}(move\_idx).as<\mbox{\hyperlink{structtesseract__planning_1_1MoveInstructionPoly}{MoveInstructionPoly}}>();}
\DoxyCodeLine{58         \textcolor{keywordflow}{if} (move.getWaypoint().isStateWaypoint())}
\DoxyCodeLine{59         \{}
\DoxyCodeLine{60           \textcolor{keyword}{auto}\& state = move.\mbox{\hyperlink{structtesseract__planning_1_1MoveInstructionPoly_a37f8f257d3921e718b072afd9d4e2fbb}{getWaypoint}}().as<\mbox{\hyperlink{structtesseract__planning_1_1StateWaypointPoly}{StateWaypointPoly}}>();}
\DoxyCodeLine{61 }
\DoxyCodeLine{62           \textcolor{keywordtype}{double} scaling\_factor = scalings[sub\_composite\_idx];}
\DoxyCodeLine{63           \textcolor{keywordflow}{if} (scaling\_factor < 1e-\/6)}
\DoxyCodeLine{64           \{}
\DoxyCodeLine{65             CONSOLE\_BRIDGE\_logWarn(\textcolor{stringliteral}{"{}Scaling factor is close to 0 (\%f), defaulting to 1"{}}, scaling\_factor);}
\DoxyCodeLine{66             scaling\_factor = 1.0;}
\DoxyCodeLine{67           \}}
\DoxyCodeLine{68 }
\DoxyCodeLine{69           state.setVelocity(state.getVelocity() * scaling\_factor);}
\DoxyCodeLine{70           state.setAcceleration(state.getAcceleration() * scaling\_factor * scaling\_factor);}
\DoxyCodeLine{71           state.setEffort(state.getEffort() * scaling\_factor * scaling\_factor);}
\DoxyCodeLine{72 }
\DoxyCodeLine{73           \textcolor{keywordtype}{double} temp = state.getTime();}
\DoxyCodeLine{74           \textcolor{comment}{// scale dt and add to previous time}}
\DoxyCodeLine{75           state.setTime(prev\_time\_scaled + (temp -\/ prev\_time\_original) / scaling\_factor);}
\DoxyCodeLine{76           prev\_time\_scaled = state.getTime();}
\DoxyCodeLine{77           prev\_time\_original = temp;}
\DoxyCodeLine{78         \}}
\DoxyCodeLine{79       \}}
\DoxyCodeLine{80     \}}
\DoxyCodeLine{81   \}}
\DoxyCodeLine{82 \}}
\DoxyCodeLine{83 \}  \textcolor{comment}{// namespace tesseract\_planning}}
\DoxyCodeLine{84 }
\DoxyCodeLine{85 \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
